import{j as e,E as K}from"./radix-ui-5LtdMfNn.js";import{r as h}from"./vendor-B4gEaEGI.js";import{C as y,d as b,a as A,b as L}from"./card-6uTiVmyf.js";import{I as Q}from"./input-x-MVjPYt.js";import{B as _}from"./badge-Bd9-fGOs.js";import{c as X,u as k,a as z,s as w,h as J}from"./main-B34cn-84.js";import{T as P,S as $,A as W}from"./trophy-r0tsLYaR.js";import{L as Y}from"./lock-CKim2fcJ.js";import{T as Z}from"./trending-up-ClWJ0Spl.js";import{S as ee}from"./search-C5rltCw-.js";import{F as se}from"./filter-Dyk2mR7A.js";import"./supabase-B07dSRCg.js";import"./ui-B2rm_Apj.js";import"./router-CYcLefUh.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=X("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),re=()=>{const{user:s}=k(),{toast:t}=z(),[r,d]=h.useState([]),[a,p]=h.useState([]),[i,o]=h.useState(!0);h.useEffect(()=>{(async()=>{try{const{data:l,error:n}=await w.from("achievements").select("*").order("category",{ascending:!0});if(n)throw n;d(l||[])}catch(l){console.error("Failed to load achievements:",l)}})()},[]),h.useEffect(()=>{if(!s){p([]),o(!1);return}(async()=>{try{const{data:n,error:g}=await w.from("user_achievements").select("*").eq("user_id",s.id).order("unlocked_at",{ascending:!1});if(g)throw g;p(n||[])}catch(n){console.error("Failed to load user achievements:",n)}finally{o(!1)}})();const l=w.channel("user-achievements").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_achievements",filter:`user_id=eq.${s.id}`},n=>{const g=n.new;p(v=>[g,...v]),t({title:"ðŸ† Achievement Unlocked!",description:`${g.achievement_name} - ${g.points_awarded} points`})}).subscribe();return()=>{w.removeChannel(l)}},[s,t]);const m=x=>r.filter(l=>l.category===x),f=x=>a.some(l=>l.achievement_code===x);return{achievements:r,userAchievements:a,loading:i,getAchievementsByCategory:m,hasAchievement:f,getAchievementProgress:()=>[...new Set(r.map(l=>l.category))].map(l=>{const n=m(l),g=n.filter(v=>f(v.achievement_code)).length;return{category:l,unlocked:g,total:n.length,percentage:n.length>0?g/n.length*100:0}}),getCategoryColor:x=>{switch(x.toLowerCase()){case"social":return"text-green-600 border-green-300";case"content":return"text-blue-600 border-blue-300";case"moderation":return"text-purple-600 border-purple-300";case"special":return"text-orange-600 border-orange-300";default:return"text-slate-600 border-slate-300"}},getTotalAchievementPoints:()=>a.reduce((x,l)=>x+(l.points_awarded||0),0)}},ae=()=>{const{user:s}=k(),[t,r]=h.useState({reputation_score:0,level:1,levelName:"Newcomer",pointsToNextLevel:100,totalPoints:0}),[d,a]=h.useState([]),[p,i]=h.useState(!0),o=[{min:0,max:99,name:"Newcomer",color:"text-slate-600"},{min:100,max:299,name:"Regular",color:"text-green-600"},{min:300,max:699,name:"Contributor",color:"text-blue-600"},{min:700,max:1499,name:"Veteran",color:"text-purple-600"},{min:1500,max:2999,name:"Expert",color:"text-orange-600"},{min:3e3,max:9999,name:"Master",color:"text-red-600"},{min:1e4,max:1/0,name:"Legend",color:"text-yellow-600"}],m=h.useCallback(u=>{const x=o.find(g=>u>=g.min&&u<=g.max)||o[0],l=o.indexOf(x),n=o[l+1];return{level:l+1,levelName:x.name,color:x.color,pointsToNextLevel:n?n.min-u:0,totalPoints:u}},[]);h.useEffect(()=>{if(!s){i(!1);return}(async()=>{try{const{data:x,error:l}=await w.from("profiles").select("reputation").eq("user_id",s.id).maybeSingle();if(l)throw l;const n=(x==null?void 0:x.reputation)||0,g=m(n);r({reputation_score:n,...g});const{data:v}=await w.from("moderation_actions").select("*").order("created_at",{ascending:!1}).limit(20);if(v){const S=v.map(c=>({id:c.id,action_type:c.action_type,action_description:c.reason||"Activity",points_earned:f(c.action_type),created_at:c.created_at,metadata:null}));a(S)}}catch(x){console.error("Failed to load reputation:",x)}finally{i(!1)}})()},[s,m]);const f=u=>{switch(u){case"MESSAGE_POST":return 2;case"REACTION_ADD":return 1;case"HELPFUL_ACTION":return 5;case"ACHIEVEMENT_UNLOCKED":return 10;default:return 0}};return{reputation:t,activities:d,loading:p,levels:o,awardPoints:async(u,x)=>{if(!s)return;const l=x||f(u);try{const{data:n}=await w.from("profiles").select("reputation").eq("user_id",s.id).maybeSingle(),v=((n==null?void 0:n.reputation)||0)+l,{error:S}=await w.from("profiles").update({reputation:v}).eq("user_id",s.id);if(!S){const c=m(v);r(N=>({...N,reputation_score:v,...c}))}}catch(n){console.error("Failed to award reputation points:",n)}},getReputationRank:async()=>{try{const{count:u}=await w.from("profiles").select("*",{count:"exact",head:!0}).gt("reputation",t.reputation_score);return(u||0)+1}catch(u){return console.error("Failed to get reputation rank:",u),null}},calculateLevel:m}},ne=({achievement:s,isUnlocked:t,unlockedAt:r,className:d=""})=>{const a=p=>{switch(p.toLowerCase()){case"social":return"border-green-300 bg-green-50";case"content":return"border-blue-300 bg-blue-50";case"moderation":return"border-purple-300 bg-purple-50";case"special":return"border-orange-300 bg-orange-50";default:return"border-slate-300 bg-slate-50"}};return e.jsx(y,{className:`${d} ${a(s.category)} transition-all duration-200 hover:shadow-md ${t?"border-2":"opacity-60"}`,children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t?"bg-primary/10":"bg-muted/30"}`,children:t?e.jsx(P,{className:"w-6 h-6 text-primary"}):e.jsx(Y,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:`font-semibold ${t?"text-foreground":"text-muted-foreground"}`,children:s.name}),e.jsx($,{className:"w-4 h-4 text-primary"})]}),e.jsx("p",{className:`text-sm ${t?"text-muted-foreground":"text-muted-foreground/70"} mb-2`,children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{variant:"outline",className:"text-xs",children:s.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{variant:"secondary",className:"text-xs",children:["+",s.points," pts"]}),t&&r&&e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(r).toLocaleDateString()})]})]})]})]})})})};function ce(s,t=[]){let r=[];function d(p,i){const o=h.createContext(i);o.displayName=p+"Context";const m=r.length;r=[...r,i];const f=j=>{var v;const{scope:u,children:x,...l}=j,n=((v=u==null?void 0:u[s])==null?void 0:v[m])||o,g=h.useMemo(()=>l,Object.values(l));return e.jsx(n.Provider,{value:g,children:x})};f.displayName=p+"Provider";function C(j,u){var n;const x=((n=u==null?void 0:u[s])==null?void 0:n[m])||o,l=h.useContext(x);if(l)return l;if(i!==void 0)return i;throw new Error(`\`${j}\` must be used within \`${p}\``)}return[f,C]}const a=()=>{const p=r.map(i=>h.createContext(i));return function(o){const m=(o==null?void 0:o[s])||p;return h.useMemo(()=>({[`__scope${s}`]:{...o,[s]:m}}),[o,m])}};return a.scopeName=s,[d,oe(a,...t)]}function oe(...s){const t=s[0];if(s.length===1)return t;const r=()=>{const d=s.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(p){const i=d.reduce((o,{useScope:m,scopeName:f})=>{const j=m(p)[`__scope${f}`];return{...o,...j}},{});return h.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}var le=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],O=le.reduce((s,t)=>{const r=K(`Primitive.${t}`),d=h.forwardRef((a,p)=>{const{asChild:i,...o}=a,m=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...o,ref:p})});return d.displayName=`Primitive.${t}`,{...s,[t]:d}},{}),I="Progress",D=100,[ie]=ce(I),[de,me]=ie(I),V=h.forwardRef((s,t)=>{const{__scopeProgress:r,value:d=null,max:a,getValueLabel:p=xe,...i}=s;(a||a===0)&&!F(a)&&console.error(ue(`${a}`,"Progress"));const o=F(a)?a:D;d!==null&&!M(d,o)&&console.error(pe(`${d}`,"Progress"));const m=M(d,o)?d:null,f=T(m)?p(m,o):void 0;return e.jsx(de,{scope:r,value:m,max:o,children:e.jsx(O.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":T(m)?m:void 0,"aria-valuetext":f,role:"progressbar","data-state":B(m,o),"data-value":m??void 0,"data-max":o,...i,ref:t})})});V.displayName=I;var U="ProgressIndicator",q=h.forwardRef((s,t)=>{const{__scopeProgress:r,...d}=s,a=me(U,r);return e.jsx(O.div,{"data-state":B(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...d,ref:t})});q.displayName=U;function xe(s,t){return`${Math.round(s/t*100)}%`}function B(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function T(s){return typeof s=="number"}function F(s){return T(s)&&!isNaN(s)&&s>0}function M(s,t){return T(s)&&!isNaN(s)&&s<=t&&s>=0}function ue(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${D}\`.`}function pe(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${D} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var H=V,he=q;const E=h.forwardRef(({className:s,value:t,...r},d)=>e.jsx(H,{ref:d,className:J("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:e.jsx(he,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));E.displayName=H.displayName;const ge=({progress:s,totalUnlocked:t,totalAchievements:r,className:d=""})=>{const a=r>0?t/r*100:0,p=i=>{switch(i.toLowerCase()){case"league":return"ðŸ†";case"cup":return"ðŸ…";case"financial":return"ðŸ’°";case"development":return"ðŸŒ±";case"social":return"ðŸ‘¥";default:return"â­"}};return e.jsxs(y,{className:d,children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-primary"}),"Achievement Progress"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),e.jsxs(_,{variant:"secondary",children:[t,"/",r]})]}),e.jsx(E,{value:a,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.toFixed(1),"% complete"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(te,{className:"w-4 h-4"}),"Categories"]}),s.map(i=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm",children:[p(i.category)," ",i.category]})}),e.jsxs(_,{variant:"outline",className:"text-xs",children:[i.unlocked,"/",i.total]})]}),e.jsx(E,{value:i.percentage,className:"h-1.5"})]},i.category))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Unlocked"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-muted-foreground",children:r-t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Remaining"})]})]})]})]})},ve=({reputation:s,className:t="",compact:r=!1})=>{const d=a=>{switch(a){case"Newcomer":return"text-slate-600 border-slate-300";case"Regular":return"text-green-600 border-green-300";case"Contributor":return"text-blue-600 border-blue-300";case"Veteran":return"text-purple-600 border-purple-300";case"Expert":return"text-orange-600 border-orange-300";case"Master":return"text-red-600 border-red-300";case"Legend":return"text-yellow-600 border-yellow-300";default:return"text-slate-600 border-slate-300"}};return r?e.jsxs("div",{className:`flex items-center gap-2 ${t}`,children:[e.jsxs(_,{variant:"outline",className:d(s.levelName),children:[e.jsx($,{className:"w-3 h-3 mr-1"}),s.levelName]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.reputation_score," pts"]})]}):e.jsxs(y,{className:t,children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),"Reputation"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs(_,{variant:"outline",className:`text-lg px-4 py-2 ${d(s.levelName)}`,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),s.levelName]}),e.jsx("div",{className:"text-2xl font-bold",children:s.reputation_score}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"reputation points"})]}),s.pointsToNextLevel>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Progress to next level"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.pointsToNextLevel," points needed"]})]}),e.jsx(E,{value:100-s.pointsToNextLevel/(s.pointsToNextLevel+100)*100,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",children:["#",s.rank||"?"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Rank"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",children:["Lv. ",s.level]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Level"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Z,{className:"w-4 h-4"}),"Keep participating to earn more points!"]})]})]})},Ee=()=>{const{user:s}=k(),{achievements:t,userAchievements:r,loading:d,hasAchievement:a,getAchievementProgress:p,getTotalAchievementPoints:i}=re(),{reputation:o}=ae(),[m,f]=h.useState(""),[C,j]=h.useState("all"),[u,x]=h.useState(!1),l=["all",...new Set(t.map(c=>c.category))],n=t.filter(c=>{const N=c.name.toLowerCase().includes(m.toLowerCase())||c.description.toLowerCase().includes(m.toLowerCase()),R=C==="all"||c.category===C,G=!u||a(c.achievement_code);return N&&R&&G}),g=p(),v=r.length,S=t.length;return d?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:[...Array(6)].map((c,N)=>e.jsx(y,{className:"animate-pulse",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/4"})]})]})})},N))}),e.jsx("div",{className:"space-y-4",children:e.jsx(y,{className:"animate-pulse",children:e.jsxs(b,{className:"p-4 space-y-4",children:[e.jsx("div",{className:"h-20 bg-muted rounded"}),e.jsx("div",{className:"h-32 bg-muted rounded"})]})})})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-primary"}),"Achievements"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track your progress and unlock rewards"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(y,{children:e.jsxs(b,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx(Q,{placeholder:"Search achievements...",value:m,onChange:c=>f(c.target.value),className:"flex-1"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(se,{className:"w-4 h-4 mt-1"}),l.map(c=>e.jsx("button",{onClick:()=>j(c),className:`px-3 py-1 rounded-full text-sm transition-colors ${C===c?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:c.charAt(0).toUpperCase()+c.slice(1)},c))]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:c=>x(c.target.checked),className:"rounded"}),"Show unlocked only"]}),e.jsxs(_,{variant:"secondary",children:[n.length," achievement",n.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[n.map(c=>{const N=r.find(R=>R.achievement_code===c.achievement_code);return e.jsx(ne,{achievement:c,isUnlocked:!!N,unlockedAt:N==null?void 0:N.unlocked_at},c.id)}),n.length===0&&e.jsx(y,{children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No achievements found."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your search or filters."})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx(ve,{reputation:o}),e.jsx(ge,{progress:g,totalUnlocked:v,totalAchievements:S}),e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),"Statistics"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:v}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Unlocked"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:i()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Points Earned"})]})]}),e.jsxs("div",{className:"text-center pt-2 border-t",children:[e.jsxs("div",{className:"text-lg font-bold",children:[S>0?(v/S*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Completion Rate"})]})]})]}),r.length>0&&e.jsxs(y,{children:[e.jsx(A,{children:e.jsx(L,{children:"Recent Unlocks"})}),e.jsx(b,{className:"space-y-2",children:r.slice(0,3).map(c=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/50 rounded",children:[e.jsx(P,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:c.achievement_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(c.unlocked_at).toLocaleDateString()})]}),e.jsxs(_,{variant:"secondary",className:"text-xs",children:["+",c.points_awarded]})]},c.id))})]})]})]})]})};export{Ee as Achievements};
