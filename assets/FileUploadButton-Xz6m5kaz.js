import{c as w,u as S,a as A,s as F}from"./main-B34cn-84.js";import{j as t}from"./radix-ui-5LtdMfNn.js";import{r as l}from"./vendor-B4gEaEGI.js";import{B as v}from"./label-CgCQUnbP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=w("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=w("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),j=10*1024*1024,k=["image/jpeg","image/png","image/gif","image/webp","text/plain","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","audio/webm","audio/mp3","audio/mpeg","audio/wav","audio/ogg","audio/mp4"],z=()=>{const{user:n}=S(),{toast:a}=A(),[g,c]=l.useState(!1),[i,f]=l.useState(0),r=l.useCallback(e=>e.size>j?"File size must be less than 10MB":k.includes(e.type)?null:"File type not supported. Allowed: images, PDF, text, and document files",[]),y=l.useCallback(async e=>{if(!n)return a({title:"Authentication Required",description:"Please log in to upload files.",variant:"destructive"}),null;const s=r(e);if(s)return a({title:"Upload Error",description:s,variant:"destructive"}),null;c(!0),f(0);try{const o=e.name.split(".").pop(),d=`${n.id}/${Date.now()}-${Math.random().toString(36).substring(2)}.${o}`,{data:p,error:u}=await F.storage.from("chat-attachments").upload(d,e,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:h,error:m}=await F.storage.from("chat-attachments").createSignedUrl(d,3600);if(m)throw m;const E={id:d,name:e.name,size:e.size,type:e.type,url:h.signedUrl,uploadedAt:new Date};return a({title:"Upload Successful",description:`${e.name} uploaded successfully`}),E}catch(o){return console.error("Upload error:",o),a({title:"Upload Failed",description:"Failed to upload file. Please try again.",variant:"destructive"}),null}finally{c(!1),f(0)}},[n,r,a]),x=l.useCallback(async(e,s)=>{try{const{error:o}=await F.storage.from("chat-attachments").remove([s]);if(o)throw o;return a({title:"File Deleted",description:"File has been successfully deleted"}),!0}catch(o){return console.error("Delete error:",o),a({title:"Delete Failed",description:"Failed to delete file. Please try again.",variant:"destructive"}),!1}},[a]);return{uploadFile:y,deleteFile:x,validateFile:r,uploading:g,uploadProgress:i,maxFileSize:j,allowedTypes:k}},B=({onFileUploaded:n,disabled:a=!1,variant:g="icon",className:c=""})=>{const i=l.useRef(null),{uploadFile:f,uploading:r,allowedTypes:y,maxFileSize:x}=z(),e=async p=>{var m;const u=(m=p.target.files)==null?void 0:m[0];if(!u)return;const h=await f(u);h&&n(h),i.current&&(i.current.value="")},s=()=>{var p;(p=i.current)==null||p.click()},o=y.join(","),d=Math.round(x/(1024*1024));return t.jsxs(t.Fragment,{children:[t.jsx("input",{ref:i,type:"file",accept:o,onChange:e,className:"hidden",disabled:a||r}),g==="icon"?t.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:s,disabled:a||r,className:`h-8 w-8 p-0 ${c}`,title:`Upload file (max ${d}MB)`,children:r?t.jsx(b,{className:"w-4 h-4 animate-spin"}):t.jsx(U,{className:"w-4 h-4"})}):t.jsx(v,{type:"button",variant:"outline",onClick:s,disabled:a||r,className:c,children:r?t.jsxs(t.Fragment,{children:[t.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"w-4 h-4 mr-2"}),"Upload File"]})})]})};export{$ as A,B as F,z as u};
