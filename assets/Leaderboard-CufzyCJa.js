import{j as e}from"./radix-ui-5LtdMfNn.js";import{r as j}from"./vendor-B4gEaEGI.js";import{C as p,d as v,a as w,b as y}from"./card-6uTiVmyf.js";import{e as U,S as C,a as k,b as _,c as L,d as u,U as A}from"./select-C65-uch7.js";import{B as b}from"./badge-Bd9-fGOs.js";import{c as E,s as S,u as V}from"./main-B34cn-84.js";import{A as q,b as D,a as F}from"./avatar-DyKoJ1Aj.js";import{S as z,A as B,T as M}from"./trophy-r0tsLYaR.js";import{T as P}from"./trending-up-ClWJ0Spl.js";import"./supabase-B07dSRCg.js";import"./ui-B2rm_Apj.js";import"./router-CYcLefUh.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=E("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),$=s=>{const[d,o]=j.useState([]),[a,x]=j.useState(!0),[c,N]=j.useState(null),i=h=>{const r=[{min:0,max:99,name:"Newcomer"},{min:100,max:299,name:"Regular"},{min:300,max:699,name:"Contributor"},{min:700,max:1499,name:"Veteran"},{min:1500,max:2999,name:"Expert"},{min:3e3,max:9999,name:"Master"},{min:1e4,max:1/0,name:"Legend"}],m=r.find(l=>h>=l.min&&h<=l.max)||r[0];return{level:r.indexOf(m)+1,levelName:m.name}};return j.useEffect(()=>{(async()=>{x(!0);try{const{data:r,error:m}=await S.from("leaderboard").select("*").order("total_points",{ascending:!1}).limit(s.limit);if(m)throw m;const t=(r==null?void 0:r.map(n=>n.user_id))||[];let l=new Map;if(t.length>0){const{data:n}=await S.from("user_achievements").select("user_id").in("user_id",t);n==null||n.forEach(g=>{l.set(g.user_id,(l.get(g.user_id)||0)+1)})}const T=(r||[]).map((n,g)=>{const{level:R,levelName:I}=i(n.total_points||0);return{id:n.id,username:n.username||"Anonymous",total_points:n.total_points||0,avatar_url:void 0,level:R,levelName:I,achievements_count:l.get(n.user_id)||0,rank:g+1}});o(T)}catch(r){console.error("Failed to load leaderboard:",r)}finally{x(!1)}})()},[s]),{leaderboard:d,loading:a,userRank:c}},f=({entry:s,isCurrentUser:d=!1,showDetailed:o=!1})=>{const a=i=>{switch(i){case 1:return e.jsx(M,{className:"w-5 h-5 text-yellow-600"});case 2:return e.jsx(Y,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(B,{className:"w-5 h-5 text-orange-600"});default:return e.jsxs("span",{className:"w-5 h-5 flex items-center justify-center text-sm font-bold",children:["#",i]})}},x=i=>{switch(i){case"Newcomer":return"text-slate-600 border-slate-300";case"Regular":return"text-green-600 border-green-300";case"Contributor":return"text-blue-600 border-blue-300";case"Veteran":return"text-purple-600 border-purple-300";case"Expert":return"text-orange-600 border-orange-300";case"Master":return"text-red-600 border-red-300";case"Legend":return"text-yellow-600 border-yellow-300";default:return"text-slate-600 border-slate-300"}},c=s.username||"Anonymous",N=c.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2);return e.jsx(p,{className:`transition-all duration-200 hover:shadow-md ${d?"ring-2 ring-primary":""}`,children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:a(s.rank)}),e.jsxs(q,{className:"h-10 w-10 flex-shrink-0",children:[e.jsx(D,{src:s.avatar_url,alt:c}),e.jsx(F,{children:N})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("h3",{className:"font-semibold truncate",children:[c,d&&e.jsx(b,{variant:"secondary",className:"ml-2 text-xs",children:"You"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",className:`text-xs ${x(s.levelName)}`,children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),s.levelName]}),o&&e.jsxs(b,{variant:"secondary",className:"text-xs",children:[s.achievements_count," achievements"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-lg font-bold",children:s.total_points}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"points"})]})]})})})},re=()=>{var h,r,m;const{user:s}=V(),[d,o]=j.useState({timeframe:"all",category:"reputation",limit:50}),{leaderboard:a,loading:x,userRank:c}=$(d),N=t=>{o(l=>({...l,timeframe:t}))},i=t=>{o(l=>({...l,category:t}))};return x?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"space-y-4",children:[...Array(10)].map((t,l)=>e.jsx(p,{className:"animate-pulse",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-muted rounded"}),e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/4"})]}),e.jsx("div",{className:"w-16 h-8 bg-muted rounded"})]})})},l))})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-8 h-8 text-primary"}),"Leaderboard"]}),e.jsx("p",{className:"text-muted-foreground",children:"Top community members ranked by reputation and achievements"})]}),e.jsx(p,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs(C,{value:d.timeframe,onValueChange:N,children:[e.jsx(k,{className:"w-32",children:e.jsx(_,{})}),e.jsxs(L,{children:[e.jsx(u,{value:"all",children:"All Time"}),e.jsx(u,{value:"month",children:"This Month"}),e.jsx(u,{value:"week",children:"This Week"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs(C,{value:d.category,onValueChange:i,children:[e.jsx(k,{className:"w-36",children:e.jsx(_,{})}),e.jsxs(L,{children:[e.jsx(u,{value:"reputation",children:"Reputation"}),e.jsx(u,{value:"achievements",children:"Achievements"}),e.jsx(u,{value:"messages",children:"Messages"})]})]})]}),s&&c&&e.jsxs(b,{variant:"secondary",className:"ml-auto",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Your Rank: #",c]})]})})}),a.length>=3&&e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(y,{className:"text-center",children:"ðŸ† Top 3 Champions"})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"order-1 md:order-1",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ¥ˆ"}),e.jsx("div",{className:"text-sm font-medium",children:"2nd Place"})]}),e.jsx(f,{entry:a[1],isCurrentUser:(s==null?void 0:s.id)===((h=a[1])==null?void 0:h.id),showDetailed:!0})]}),e.jsxs("div",{className:"order-0 md:order-2",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("div",{className:"text-5xl",children:"ðŸ‘‘"}),e.jsx("div",{className:"text-sm font-medium",children:"Champion"})]}),e.jsx(f,{entry:a[0],isCurrentUser:(s==null?void 0:s.id)===((r=a[0])==null?void 0:r.id),showDetailed:!0})]}),e.jsxs("div",{className:"order-2 md:order-3",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ¥‰"}),e.jsx("div",{className:"text-sm font-medium",children:"3rd Place"})]}),e.jsx(f,{entry:a[2],isCurrentUser:(s==null?void 0:s.id)===((m=a[2])==null?void 0:m.id),showDetailed:!0})]})]})})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(y,{children:"Full Rankings"})}),e.jsxs(v,{className:"space-y-2",children:[a.map(t=>e.jsx(f,{entry:t,isCurrentUser:(s==null?void 0:s.id)===t.id,showDetailed:!0},t.id)),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No rankings available yet."}),e.jsx("p",{className:"text-sm",children:"Start participating to appear on the leaderboard!"})]})]})]})]})};export{re as Leaderboard};
